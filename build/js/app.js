!function e(t,i,o){function s(r,a){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=i[r]={exports:{}};t[r][0].call(d.exports,function(e){var i=t[r][1][e];return s(i?i:e)},d,d.exports,e,t,i,o)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<o.length;r++)s(o[r]);return s}({"/home/zdespolit/projects/_archive/towers/client/views/Router.js":[function(e,t,i){var o=e("views/MainView"),s=e("views/base/TableView");t.exports=function(){var e=Backbone.Router.extend({routes:{"":"main",users:"users"},main:function(){o.get().show(),$("#users-list").hide()},users:function(){var e=$("#users-list");e.show(),new s({el:e,collection:BaseCollection.createCollection("users",User),collections:{locations:BaseCollection.createCollection("locations",Location)}}).show(),$(".user, .legend").hide(),$(".acc-item.toggle").click(function(){window.location.href="/"})}}),t=function(){new e,Backbone.history.start({pushState:!0})},i=[],n=function(e){i.push(e),2==i.length&&t()};return ymaps.ready(function(){n("yandex maps")}),$(function(){n("dom")}),{}}()},{"views/MainView":"/home/zdespolit/projects/_archive/towers/node_modules/views/MainView.js","views/base/TableView":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/TableView.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/components/accordion.js":[function(e,t,i){$(function(){var e=Backbone,t=$(".accordion");window.initAccordion=function(){t.find(".acc-item-data").hide(),t.find(".toggle").data("state",!1),t.find(".acc-item").click(function(i){if(0!=$(i.target).hasClass("acc-item-name")){t.find(".acc-item").removeClass("active");var o=$(this),s=o.find(".acc-item-data");if(!s.length)return void t.find(".acc-item-data").hide();s.is(":hidden")?(t.find(".acc-item-data").hide(),o.addClass("active"),s.show(),e.trigger("change:accordion",o.data("type"))):s.hide(),i.stopPropagation()}}),t.find(".toggle").click(function(t){var i=$(this),o=!i.data("state"),s=$(".acc-item");o?(s.show(),i.find("span").text("◁")):(s.hide(),i.find("span").text("▷"),s.css("min-width","55px")),i.data("state",o),i.show(),e.trigger("toggle:accordion",o),t.preventDefault()})},window.accSelect=function(e){var t=$(".acc-item.toggle");t.data("state",!0);var i=$(".acc-item");i.show(),t.find("span").text("▷"),t.find("span").css("font-size",""),$(".acc-item."+e).hasClass("active")||$(".acc-item."+e+" .acc-item-name").click()},window.accSelectWithoutEvents=function(e){t.find(".acc-item").removeClass("active"),t.find(".acc-item-data").hide(),e.addClass("active"),e.find(".acc-item-data").show()}})},{}],"/home/zdespolit/projects/_archive/towers/node_modules/models/BaseCollection.js":[function(e,t,i){t.exports=function(){function e(e){var t=e.toLowerCase();return t=t.split(""),t=_.map(t,function(e){return String.fromCharCode(-e.charCodeAt(0))})}var t=Backbone.Collection.extend({setSort:function(t){t=t||{};var i=t.attr||"name",o=t.dir||!this.sortOpts||this.sortOpts.attr!=i?"asc":"asc"==this.sortOpts.dir?"desc":"asc";this.comparator=function(t){var s=t.get(i);return"asc"==o?s:"freq"==i?-s:e(s)},this.sortOpts={attr:i,dir:o}}});return t.createCollection=function(e,i,o,s){function n(e){try{return JSON.parse($(".data-holder."+e).html())}catch(t){return[]}}s=s||n(e);var r=new(t.extend({model:i}))(s,o);return r.fields=(new i).fields,r.setSort(),r.sort(),r},t}()},{}],"/home/zdespolit/projects/_archive/towers/node_modules/models/BaseModel.js":[function(e,t,i){t.exports=function(){return Backbone.Model.extend({_getName:function(){return this.name||this.url.replace(/s$/,"")},save:function(e){e=e||{};var t={};t[this._getName()]=this._toJSON?this._toJSON():this.toJSON(),e.url="/rest/"+this.url+"?"+$.param(t),Backbone.Model.prototype.save.call(this,null,e),this.changed={},this.markToRevert()},set:function(){return Backbone.Model.prototype.set.apply(this,arguments)},markToRevert:function(){this.restoreAttributes=_.clone(this.attributes)},revert:function(){this.restoreAttributes&&this.set(this.restoreAttributes,{silent:!0})},getV:function(e){return this.get(e)},destroy:function(){Backbone.Model.prototype.destroy.call(this,{url:"/rest/"+this.url+"/"+this.id})},__validate:function(e){var t=null;return _.each(e,_.bind(function(e){var i="";if(_.isString(e))this.get(e)||(i="Обязательное поле");else{if(!_.isObject(e))throw new Error("Unsupported obj type.");var o=this.get(e.name);i=e.validate(o)}if(i){var s="invalid:"+(e.name||e);this.trigger(s,i),t=t||{},t[e]=i}},this)),t}})}()},{}],"/home/zdespolit/projects/_archive/towers/node_modules/models/Freq.js":[function(e,t,i){var o=e("models/BaseModel");t.exports=function(){return o.extend({url:"freqs",fields:[{name:"value",label:"Частота"},{name:"color",label:"Цвет"},{name:"type",label:"Тип"}],shouldShow:function(){return this.get("show")!==!1},isShown:function(){return this.shouldShow()},switchVisibility:function(){this.set({show:!this.shouldShow()})}})}()},{"models/BaseModel":"/home/zdespolit/projects/_archive/towers/node_modules/models/BaseModel.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/models/GeoObject.js":[function(e,t,i){var o=e("models/BaseModel");t.exports=function(){function e(e){return e?_.isArray(e)?e:[e.latitude,e.longitude]:null}function t(e){return e?{latitude:e[0],longitude:e[1]}:{latitude:null,longitude:null}}return o.extend({fields:[{name:"name",label:"Название"},{name:"comment",label:"Комментарий"}],initialize:function(e,t){e&&(e=this.parse(e),this.set(e))},_toJSON:function(){var e=_.clone(this.attributes);return e.start=t(e.start),e.end&&this.is&&this.is("highway")?e.end=t(e.end):delete e.end,delete e._towers,delete e.towers,e},parse:function(t){return t?(t.start&&(t.start=e(t.start)),t.end&&(t.end=e(t.end),t.type=t.type||"highway"),t.comment&&(t.comment=t.comment.replace(/&lt;/g,"<").replace(/&gt;/g,">")),t):void 0},validate:function(){var e=this.id;return this.__validate(["name",{name:"name",validate:function(t){var i=state.get("locations").find(function(i){return i.get("name")==t&&i.id!=e});return i?"Не уникальное название":void 0}}])}})}()},{"models/BaseModel":"/home/zdespolit/projects/_archive/towers/node_modules/models/BaseModel.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/models/Location.js":[function(e,t,i){var o=(e("models/BaseModel"),e("models/BaseCollection")),s=e("models/GeoObject"),n=e("models/Tower");t.exports=function(){function e(e){return e?_.isArray(e)?e:[e.latitude,e.longitude]:null}function t(e){return e?{latitude:e[0],longitude:e[1]}:{latitude:null,longitude:null}}return s.extend({url:"locations",fields:[{name:"name",label:"Название"},{name:"comment",label:"Комментарий"}],initialize:function(e,t){e&&(e=this.parse(e),this.set(e))},is:function(e){return"location"==e},isTower:function(){return this.is("tower")},_toJSON:function(){var e=_.clone(this.attributes);return e.start=t(e.start),e.end&&this.is&&this.is("highway")?e.end=t(e.end):delete e.end,delete e._towers,delete e.towers,e},parse:function(t){return t?(t.start&&(t.start=e(t.start)),t.end&&(t.end=e(t.end),t.type=t.type||"highway"),t.comment&&(t.comment=t.comment.replace(/&lt;/g,"<").replace(/&gt;/g,">")),t):void 0},validate:function(){var e=this.id;return this.__validate(["name",{name:"name",validate:function(t){var i=state.get("locations").find(function(i){return i.get("name")==t&&i.id!=e});return i?"Не уникальное название":void 0}}])},getTowers:function(){if(this.get("_towers"))e=this.get("_towers");else{var e=o.createCollection("towers",n,{},this.get("towers"));this.set({_towers:e})}return e},getPoints:function(){var e=this.get("id"),t=state.get("points").filter(function(t){return t.get("locationId")==e});return _(t)},getName:function(){return this.get("name")||"Новая локация"}})}()},{"models/BaseCollection":"/home/zdespolit/projects/_archive/towers/node_modules/models/BaseCollection.js","models/BaseModel":"/home/zdespolit/projects/_archive/towers/node_modules/models/BaseModel.js","models/GeoObject":"/home/zdespolit/projects/_archive/towers/node_modules/models/GeoObject.js","models/Tower":"/home/zdespolit/projects/_archive/towers/node_modules/models/Tower.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/models/Point.js":[function(e,t,i){var o=e("models/Location");t.exports=function(){var e="",t=12;return o.extend({url:"points",initialize:function(e){e=this.parse(e||{}),this.set(e),this.set({radius:t})},getTower:function(){var e=state.get("locations").get(this.get("locationId"));return e.getTowers().get(this.get("towerId"))},is:function(e){return"point"==e},validate:function(){return null},setName:function(){this.set({name:e||"без имени"})}},{setName:function(t){e=t}})}()},{"models/Location":"/home/zdespolit/projects/_archive/towers/node_modules/models/Location.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/models/State.js":[function(e,t,i){t.exports=function(){return State=Backbone.Model.extend({fields:["locations","location","tower","freqs","editModel"],initialize:function(){this.on("change:editModel",_.bind(function(e,t){t&&(this.previous=t)},this))},getPreviousEditModel:function(){return this.previous}})}()},{}],"/home/zdespolit/projects/_archive/towers/node_modules/models/Templates.js":[function(e,t,i){var o=e("views/config");t.exports=function(){function e(e,t){return _.template(e,t,{interpolate:/\!\{(.+?)\}/g})}var t={},i=Backbone.Model.extend({execute:function(t){return e(this.get("src"),t)}}),s=function(e){if(o.isProd){var s=new $.Deferred;t[e]&&s.resolve(t[e]);var n=$("#template-"+e);return n.length?(t[e]=new i({src:n.html()}),s.resolve(t[e])):s.reject("template not found:",e),s}return $.get("/rest/templates/"+e+".html").pipe(function(e){return new i({src:e})})};return{get:s}}()},{"views/config":"/home/zdespolit/projects/_archive/towers/node_modules/views/config.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/models/Tower.js":[function(e,t,i){{var o=e("models/GeoObject");e("models/Point")}t.exports=function(){var e={tower:["60°","90°","120°","360°"],highway:["15'","20'","30'"]},t=o.extend({url:"towers",fields:[{name:"angle",label:"Угол"},{name:"name",label:"Название"},{name:"freq",type:"float",label:"Частота"},{name:"comment",label:"Комментарий"},"type","color"],fields2:["start","radius","azimuth","end"],initialize:function(t){if(t){if(t=this.parse(t),!t.angle){if(!t.type)throw new Error("Unable to determine tower type. "+t);t.angle=e[t.type][0]}this.set(t)}this.on("change:type",_.bind(function(){this.set("angle",e[this.get("type")][0])},this))},getName:function(){return this.get("name")?(this.isHighway()?"Точка-точка":"Вышка")+" "+this.get("name"):"Новая "+(this.isHighway()?"точка-точка":"вышка")},_isNew:function(){return!this.get("radius")},getPoints:function(){var e=this.get("id"),t=state.get("points").filter(function(t){return t.get("towerId")==e});return _(t)},getColor:function(){return this.getFreq_().get("color")},getFreq_:function(){var e=parseFloat(this.get("freq")),t=state.get("freqs").findWhere({value:e});return t?t:void 0},updateColor:function(){var e=this.getFreq_();this.set({color:e.get("color")})},isTower:function(){return!0},is:function(e){return this.get("type")==e},isHighway:function(){return this.is("highway")},validate:function(){return this.__validate(["freq","name"])}});return t.angles=e,t}()},{"models/GeoObject":"/home/zdespolit/projects/_archive/towers/node_modules/models/GeoObject.js","models/Point":"/home/zdespolit/projects/_archive/towers/node_modules/models/Point.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/MainView.js":[function(e,t,i){var o=(e("components/accordion"),e("models/BaseCollection")),s=e("models/Point"),n=(e("models/Tower"),e("models/Location")),r=e("models/Freq"),a=e("models/State"),l=e("views/base/View"),c=e("views/forms/TowerView"),d=e("views/forms/LocationView"),h=e("views/forms/TowersView"),u=e("views/forms/LocationsView"),m=e("views/forms/PointsView"),f=e("views/forms/LegendView"),p=e("views/MapView"),w=o.createCollection;t.exports=function(){var e,t,i,o,v=window.state=new a,g=null,b=l.extend({initialize:function(){e=w("freqs",r,{comparator:function(e){return parseFloat(e.get("value"))}}),t=w("locations",n),i=w("points",s),v.set({locations:t,freqs:e,location:t.first(),points:i,showLocations:!0,showPoints:!0}),this.views={towersList:new h({el:".acc-item.towers-list",name:"Вышки"}),locationsList:new u({el:".acc-item.locations-list",collection:t,name:"Локации"}),pointsList:new m({el:".acc-item.points-list",name:"Точки"})},new f({el:".legend"});var a=null;v.on("change:editModel",_.bind(function(t,i){if(a&&a.remove(),i){a=i.is("tower")?new c({freqs:e,model:i}):i.is("location")?new d({model:i}):null,a&&a.renderAsync().done(function(){var e=$(".item-view");e.html(a.$el),accSelectWithoutEvents(e)});var s=i.url.replace(/s$/,"");t.set(s,i),i.on("sync",function(){t.trigger("sync:"+s,t,i)})}else{var n=t.getPreviousEditModel(),r=n.is("point")?3:n.is("tower")?2:1;accSelectWithoutEvents($(".acc-item:eq("+r+" )"))}o.setModel(i)},this))},render:function(){this.initViews(),this.initFreqs()},initViews:function(){var i=new $.Deferred,s=[];ymaps.ready(function(){i.resolve()}),s.push(i),_.each(this.views,function(e){e.render&&e.render(),e.renderAsync&&s.push(e.renderAsync())}),$.when.apply($,s).then(_.bind(function(){o=window.map=new p({freqs:e,locations:t}),this.initAccordion();var i=v.get("location");i&&setTimeout(function(){v.trigger("change:location",v,i)})},this))},initFreqs:function(){e.on("change",function(e,t,i){var s=v.get("location").getTowers(),n=s.filter(function(t){return t.getFreq_().cid==e.cid});setTimeout(function(){o.redrawTowers(_(n))})})},initAccordion:function(){window.initAccordion(),$(".accordion").on("hover",function(e){return e.preventDefault(),!1})}});return b.get=function(){return g||(g=new b),g},b}()},{"components/accordion":"/home/zdespolit/projects/_archive/towers/node_modules/components/accordion.js","models/BaseCollection":"/home/zdespolit/projects/_archive/towers/node_modules/models/BaseCollection.js","models/Freq":"/home/zdespolit/projects/_archive/towers/node_modules/models/Freq.js","models/Location":"/home/zdespolit/projects/_archive/towers/node_modules/models/Location.js","models/Point":"/home/zdespolit/projects/_archive/towers/node_modules/models/Point.js","models/State":"/home/zdespolit/projects/_archive/towers/node_modules/models/State.js","models/Tower":"/home/zdespolit/projects/_archive/towers/node_modules/models/Tower.js","views/MapView":"/home/zdespolit/projects/_archive/towers/node_modules/views/MapView.js","views/base/View":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/View.js","views/forms/LegendView":"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/LegendView.js","views/forms/LocationView":"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/LocationView.js","views/forms/LocationsView":"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/LocationsView.js","views/forms/PointsView":"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/PointsView.js","views/forms/TowerView":"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/TowerView.js","views/forms/TowersView":"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/TowersView.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/MapView.js":[function(e,t,i){var o=(e("models/Tower"),e("models/Location"),e("views/map/Sector")),s=e("views/map/Geo");t.exports=function(){var e=window.ymaps,t=null,i=function(e){this.data=e};return i.prototype.remove=function(){t.geoObjects.remove(this.data)},Backbone.View.extend({initialize:function(){this.model=null,this.towersGeoObjects={},this.locationGeoObjects={},this.pointsGeoObjects={},this.initMap(),this.bindEvents()},initMap:function(){t&&t.destroy();var i=state.get("location")?state.get("location").get("start"):null;t=new e.Map("map",{center:i||[56.8,60.7],zoom:10,controls:["searchControl","typeSelector","fullscreenControl","rulerControl"],behaviors:["default","scrollZoom"]}),t.options.set("scrollZoomSpeed",5),t.events.add("click",this.onClick,this),t.events.add("mousemove",_.throttle(this.onHover,50),this),t.controls.add("zoomControl",{left:5,bottom:15}),this.drawLocations()},bindEvents:function(){document.addEventListener("keyup",_.bind(this.keyUpListener,this)),Backbone.on("update:location",_.bind(function(e){this.removeLocation(e),this.drawLocation(e)},this)),state.get("locations").on("remove",_.bind(function(e){this.removeLocation(e)},this));var e=300;this.listenTo(state,"click:object",function(i){i&&i.get("start")&&(t.panTo(i.get("start"),{delay:0,duration:e}),setTimeout(_.bind(function(){i.isTower()&&this.getTower(i.cid)?this.getTower(i.cid).openBalloon():i.is("point")&&this.showPointHint(i)},this),e+50))},this),this.listenTo(state,"change:location",function(){var t=state.get("location");if(t&&(this.removeTowers(),this.removePoints(),this.destroyCurrentObject(),!t.isNew())){var i=this;setTimeout(function(){t.getTowers().on("destroy",function(e){var t=i.towersGeoObjects[e.cid];t&&t.remove()}),setTimeout(function(){i.drawTowers(t.getTowers()),i.drawPoints()},e+50)})}},this),this.listenTo(state,"change:showLocations",function(e,t){this.drawLocations()},this),this.listenTo(state,"change:showPoints",function(){this.drawPoints()},this),this.listenTo(state.get("points"),"destroy",function(e){var t=this.pointsGeoObjects[e.cid];t&&t.remove()},this),this.listenTo(state,"redraw:point",function(e){var t=this.pointsGeoObjects[e.cid];t&&t.remove(),this.drawPoint(e)},this)},setModel:function(e){this.model=e,this.destroyCurrentObject()},keyUpListener:function(e){27==e.keyCode&&(this.model&&this.model.set({start:null,end:null}),this.destroyCurrentObject())},destroyCurrentObject:function(){this.object&&(this.object.remove(),this.object=null)},fitsToLocation:function(e){var t=state.get("location"),i=s.getDistance(e,t.get("start"));return i<=t.get("radius")},onClick:function(e){if(this.model){var t=this.model,i=e.get("coords");if(t.get("start"))t.isTower()&&this.setEnd(i),t.isValid()&&(t.trigger("beforeSave"),t.save({validate:!1}),this.draw(t),t.isTower()?state.get("location").getTowers().add(t):t.is("location")&&(state.set("location",t),state.get("locations").add(t)),state.set("editModel",null));else{var o=i;t.isTower()&&(this.fitsToLocation(o)||(alert("Данная точка не принадлежит текущей локации."),o=null)),t.set({start:o}),t.is("point")&&(t.setName(),t.save({validate:!1}),this.draw(t),state.get("points").add(t),state.set("editModel",null))}this.trigger("click")}},onHover:function(e){if(this.model&&this.model.get("start")){var i=e.get("coords"),s=this.model.get("end");if(!(s&&Math.abs(s[0]-i[0])<1e-4&&Math.abs(s[1]-i[1])<1e-4)){this.setEnd(i);var n=this.object;this.object=this.model.isTower()?new o(this.model.get("start"),this.model.attributes,t,{raw:!0}):this.model.is("location")?this.drawLocation(this.model):this.drawPoint(this.model,{edit:!0}),this.object.render&&this.object.render(),n&&n.remove()}}},setEnd:function(e){var t=s.getDistance(this.model.get("start"),e);this.model.is("tower")&&(t=Math.min(t,15e3)),this.model.set({azimuth:s.getAzimuth(this.model.get("start"),e),radius:t,end:e})},draw:function(e){e.isTower()?(e._isNew()||this.removeTower(e),this.drawTower(e)):e.is("location")?this.drawLocation(e):this.drawPoint(e)},removeTower:function(e){e.isHighway()?(this.removeTowerObj(e.cid+"0"),this.removeTowerObj(e.cid+"1")):this.removeTowerObj(e.cid)},removeTowerObj:function(e){var t=this.towersGeoObjects[e];t&&t.remove()},removeLocation:function(e){var t=this.locationGeoObjects[e.cid];t&&_.each(t,function(e){e.remove()})},getTower:function(e){return this.towersGeoObjects[e]},drawTower:function(e){if(e.is("highway")){this.towersGeoObjects[e.cid+"0"]=new o(e.get("start"),e.attributes,t).render();var i=_.clone(e.attributes),s=i.azimuth;i.azimuth=s>0?s-Math.PI:Math.PI+s,this.towersGeoObjects[e.cid+"1"]=new o(e.get("end"),i,t).render()}else this.towersGeoObjects[e.cid]=new o(e.get("start"),e.attributes,t).render()},createCircle:function(o,s){var n=new e.Circle([o.get("start"),o.get("radius")],{},_.extend({interactivityModel:"default#transparent",draggable:!1},s));t.geoObjects.add(n);var r=new i(n);return r},drawLocation:function(e){var t=this.createCircle(e,{fillColor:"#0000",strokeColor:"#83h",strokeOpacity:.4,strokeWidth:2});return this.locationGeoObjects[e.cid]=this.locationGeoObjects[e.cid]||[],this.locationGeoObjects[e.cid].push(t),t},drawPoints:function(){var e=state.get("showPoints"),t=this;if(e){var i=state.get("location").getPoints();i.each(function(e){t.drawPoint(e)})}else this.removePoints()},drawPoint:function(e,i){i=i||{};var o=e.getTower(),s=this.createCircle(e,{fillColor:o.getColor(),strokeColor:o.getColor(),strokeOpacity:.4,zIndex:99999,opacity:e.is("point")?.8:1});return this.pointsGeoObjects[e.cid]=s,i.edit||(s.data.modelCid=e.cid,s.data.events.add("mouseenter",_.bind(function(e){var t=e.get("target").modelCid,i=state.get("points").get(t);this.showPointHint(i)},this)).add("mouseleave",function(e){t.hint.close()})),s},showPointHint:function(e){t.hint.open(e.get("start"),e.getTower().get("name")+" - "+e.get("name"))},drawTowers:function(e){e.each(_.bind(function(e){var t=e.getFreq_();t.shouldShow()&&(e.set("color",t.get("color")),this.drawTower(e))},this))},redrawTowers:function(e){e.each(_.bind(function(e){this.removeTower(e),e.getFreq_().shouldShow()&&(e.updateColor(),this.drawTower(e))},this))},isShown:function(e){return this.towersGeoObjects[e.cid]||this.towersGeoObjects[e.cid+"0"]},drawLocations:function(){var e=state.get("showLocations");this.removeLocations(),e&&state.get("locations").each(_.bind(function(e){this.drawLocation(e)},this))},removeAll:function(){this.removeLocations(),this.removeTowers(),this.removePoints()},removeTowers:function(){_.forOwn(this.towersGeoObjects,function(e){e.remove()}),this.towersGeoObjects={}},removeLocations:function(){_.each(this.locationGeoObjects,_.bind(function(e){_.each(e,function(e){e.remove()})},this)),this.locationGeoObjects={}},removePoints:function(){_.each(this.pointsGeoObjects,function(e){e.remove()}),this.pointsGeoObjects={}}})}()},{"models/Location":"/home/zdespolit/projects/_archive/towers/node_modules/models/Location.js","models/Tower":"/home/zdespolit/projects/_archive/towers/node_modules/models/Tower.js","views/map/Geo":"/home/zdespolit/projects/_archive/towers/node_modules/views/map/Geo.js","views/map/Sector":"/home/zdespolit/projects/_archive/towers/node_modules/views/map/Sector.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/base/FieldView.js":[function(e,t,i){t.exports=function(){window.FieldView=Backbone.View.extend({initialize:function(e){_.bindAll(this);var t=this.$input=e.$el,i=this.fieldName=_.isString(e.field)?e.field:e.field.name;this.field=_.isObject(e.field)?e.field:{name:i};this.model=e.model;!t.length,this.bindField()},bindField:function(){this.isChanging=!1,this.$input.on(this.getPropertyToListenTo(),this.inputChangeListener),this.model.on("change:"+this.fieldName,this.modelChangeListener),this.model.on("invalid:"+this.fieldName,this.invalidListener),this.setValue(this.model.get(this.fieldName))},inputChangeListener:function(){this.removeErrors(),this.isChanging=!0;var e=this.getRawValue(),t=this.model.get(this.fieldName);if(this.isValid(e)){var i=this.parseValue(e),o=t==i||_.isEqual(t,i);o||this.model.set(this.fieldName,e)}else this.model.set(this.fieldName,t),this.setValue(t);this.isChanging=!1},modelChangeListener:function(){this.isChanging||this.setValue(this.model.get(this.fieldName))},invalidListener:function(e){var t=this.$input.parents(".form-group");t.removeClass("has-error"),this.setErrorMessage(e),setTimeout(function(){t.addClass("has-error"),t.addClass("force"),setTimeout(function(){t.removeClass("force")})})},removeErrors:function(){var e=this.$input.parents(".form-group");e.removeClass("has-error"),e.removeClass("force"),this.setErrorMessage("")},remove:function(){this.$input.off(this.getPropertyToListenTo(),this.inputChangeListener),this.model.off("change:"+this.fieldName,this.modelChangeListener),this.model.off("invalid:"+this.fieldName,this.invalidListener),this.off()},getRawValue:function(){var e=this.$input,t=e.prop("type");switch(t){case"text":case"textarea":case"select-one":case"select-multiple":case"color":return e.val();case"checkbox":return e.is(":checked");default:throw new Error("Cant get value of `"+e.selector+"`")}},getValue:function(){return this.parseValue(this.getRawValue())},getPropertyToListenTo:function(){var e=this.$input;switch(e.prop("type")){case"text":case"textarea":return"keyup";case"select-one":case"select-multiple":case"color":case"checkbox":return"change"}return null},parseValue:function(e){var t="parse"+this.fieldName[0].toUpperCase()+this.fieldName.substring(1),i=this.model[t];return i&&_.isFunction(i)?i.call(this,e):e},prepareValue:function(e){var t="prepare"+this.fieldName[0].toUpperCase()+this.fieldName.substring(1),i=this.model[t];return i&&_.isFunction(i)?i.call(this,e):e},setValue:function(e){var t=this.prepareValue(e),i=this.$input.prop("type");switch(i){case"text":case"textarea":case"color":case"select-one":case"select-multiple":this.$input.val(t);break;case"checkbox":this.$input.prop("checked",t);break;default:throw new Error("Cant set value to `"+this.$input.selector+"`")}},isValid:function(e){if(this.field.type)switch(this.field.type){case"float":return!isNaN(e)||e.replace&&!isNaN(e.replace(",","."));case"int":return!isNaN(e)}return!0},getInput:function(){return this.$input},setErrorMessage:function(e){var t=this.formGroup().find(".error-msg");t.html(e)},formGroup:function(){return this.$input.parents(".form-group")}})}()},{}],"/home/zdespolit/projects/_archive/towers/node_modules/views/base/ListView.js":[function(e,t,i){var o=e("views/base/View");t.exports=function(){return o.extend({_getModel:function(e){var t=e.parent("li").data("cid");return this.collection.get(t)},events:{"click .list-el":function(e){var t=$(e.currentTarget),i=this.collection.get(t.data("cid"));this.__setActive(i,{$el:t,click:!0})},"mousedown .add":function(e){var t=$(e.currentTarget);t.addClass("active")},"click .add":function(e){var t=$(e.currentTarget);t.removeClass("active");var i=this._createModel();return i&&(state.set("editModel",i),this.__setActive(i,{add:!0,click:!0})),e.stopPropagation(),!1},"click .remove":function(e){var t=$(e.currentTarget),i=this._getModel(t);return this._canRemove(i)&&confirm(this._removeMsg())&&i.destroy(),e.stopPropagation(),!1},"click .edit":function(e){var t=$(e.currentTarget),i=this._getModel(t);this._editModel(i,t),this.__setActive(i,{$el:t,click:!0})},"mouseenter .list-el":function(e){$(e.currentTarget).find(".glyphicon").show()},"mouseleave .list-el":function(e){$(e.currentTarget).find(".glyphicon").hide()},"change .show-locations":function(e){var t=$(e.currentTarget);state.set("showLocations",t.is(":checked"))},"mousedown .sort":function(e){var t=$(e.currentTarget);t.addClass("active")},"click .sort":function(e){var t=$(e.currentTarget),i=t.data("sort-attr");this.collection.setSort({attr:i}),this.collection.sort(),t.removeClass("active")}},bindToStateEvents:function(){this.stopListening(state,"change:editModel"),this.listenTo(state,"change:editModel",_.bind(function(e){null==e.get("editModel")&&e.getPreviousEditModel()&&e.getPreviousEditModel().url==this._getType()&&this.__dropActive()},this)),this.stopListening(state,"sync:"+this._getType()),this.listenTo(state,"sync:"+this._getType(),_.bind(function(e,t){this.__setActive(t,{click:!1})},this))},renderAsync:function(){return this.collection?this.templateP.done(_.bind(function(e){var t=this.$el.find(".acc-item-data").css("display"),i=e.execute(this._data());this.$el.html(i),this.$el.find(".acc-item-data").css("display",t),this.$el.find(".glyphicon").hide(),this._afterRender(),this.bindToStateEvents(),this.delegateEvents()},this)):void 0},setCollection:function(e){this.collection&&this.stopListening(this.collection),this.collection=e,this.listenTo(this.collection,"add remove reset change sync sort",this.renderAsync),this.renderAsync()},_data:function(){var e=this.collection.map(function(e){return{name:e.get("name"),cid:e.cid,freq:e.is("tower")?e.get("freq"):"",color:e.is("tower")?e.getColor():""}});return{name:this.name,type:this._getType(),list:e,sort:{name:this.mapSortOpts("name"),freq:this.mapSortOpts("freq")}}},mapSortOpts:function(e){var t=this.collection.sortOpts;return t.attr==e?{dir:"asc"==t.dir?"down":"up",active:"active"}:{dir:"down",active:""}},_editModel:function(e){state.set("editModel",e)},__setActive:function(e,t){t=t||{},this.__dropActive(),t.add?t.$el=this.$el.find(".add"):t.$el||(t.$el=this.$el.find('li[data-cid="'+e.cid+'"]')),t.$el.addClass("active"),t.click&&(state.trigger("click:object",e),state.set(this._getType(),e))},__dropActive:function(){this.$el.find("li").removeClass("active")},_createModel:function(){throw new Error("unimplemented")},_removeMsg:function(){throw new Error("unimplemented")},_canRemove:function(){return!0},_afterRender:function(){},_getType:function(){throw new Error("Type not defined")}})}()},{"views/base/View":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/View.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/base/TableView.js":[function(e,t,i){var o=e("views/base/View"),s=e("views/base/FieldView"),n=(e("models/Freq"),e("models/Templates"));t.exports=function(){return o.extend({events:{"click .add":"addModel","click .remove":"removeModel","click .edit":"editModel"},initialize:function(e){this.options=e,this.fields=this.collection.fields,this.collections=this.options.collections,this.tableTemplate=n.get("table"),this.trTemplate=n.get("tr"),_.bindAll(this,["inputHandler","closeInput"]),this.bindEvent($("body"),"click",this.closeInput),this.save=!0},render:function(){return this.renderAsync(),this},remove:function(){o.prototype.remove.call(this)},renderAsync:function(){var e=this.collection.fetch();return $.when(this.tableTemplate,this.trTemplate,e).done(_.bind(function(e,t){var i={fields:this.fields,collection:this.collection.models,trTemplate:t},o=e.execute(i);return this.$el.html(o),this},this))},addModel:function(e){this.trTemplate.done(_.bind(function(e){var t=new this.collection.model,i=e.execute({model:t,fields:this.fields});this.collection.add(t),this.$("tbody").append(i),setTimeout(_.bind(function(){this.$("tbody").find("tr:last").find("td:first").click()},this))},this))},removeModel:function(e){var t=$(e.currentTarget),i=this._getModel(t);i&&confirm("Действительно удалить данные?")&&(t.parent("tr").remove(),i.destroy())},editModel:function(e){var t=$(e.currentTarget),i=t.data("field"),o=this._getModel(t),s=i&&this.field!=i,n=o&&this.model!=o;if(s||n){this.closeInput(),this.model=o,this.field=i,this.td=t;var r=this.createInput();this.bindEvent(r,"keydown",this.inputHandler),setTimeout(function(){r.focus()})}e.stopPropagation()},saveModel:function(){this.model&&this.model.hasChanged()&&this.model.save(),this.save=!0},createInput:function(){var e=this.td,t=this.field,i=this.model,o=i.get(t),n=null,r=this._getField(t).input;switch(r){case"textarea":n=$("<textarea>");break;case"select-multiple":if(!this.collections||!this.collections[t])throw new Error("Collection for field "+t+" not defined");n=$("<select>"),n.attr("multiple","multiple"),this.collections[t].each(function(e){var t=$("<option>");t.attr("value",e.get("name")),t.html(e.get("name")),n.append(t)});break;default:n=$("<input>")}return e.html(n),n.val(o),this.fieldView=new s({$el:n,field:t,model:i}),n},closeInput:function(){this.save&&this.saveModel(),this.closeFieldView(),this.model=null,this.field=null,this.td=null},closeFieldView:function(){if(this.fieldView){var e=this.fieldView.getInput();e.parent().html(this.model.getV(this.field)),e.remove(),this.fieldView.remove(),
this.fieldView=null}},_getModel:function(e){var t=e.parent("tr").data("model-cid");return this.collection.get(t)},inputHandler:function(o){var s=o.which;switch(s){case e:this.closeInput();break;case t:this.save=!1,this.closeInput();break;case i:var n=this._getNextCell();n.length?n.click():this.closeInput()}},_getNextCell:function(){var e=this.td.index(),t=e+1,i=this.td.parent().children(".edit");if(t<i.length)return $(i.get(t));var o=this.td.parent("tr").index(),s=o+1;return this.td.parents("tbody").children(":eq("+s+")").find(".edit:first")},_getField:function(e){return _.find(this.fields,function(t){return t.name==e})}});var e,t,i}()},{"models/Freq":"/home/zdespolit/projects/_archive/towers/node_modules/models/Freq.js","models/Templates":"/home/zdespolit/projects/_archive/towers/node_modules/models/Templates.js","views/base/FieldView":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/FieldView.js","views/base/View":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/View.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/base/View.js":[function(e,t,i){t.exports=function(){return Backbone.View.extend({fields:[],show:function(){this.rendered||(this.render(),this.rendered=!0),this.$el.show()},hide:function(){this.$el.hide()},bindFields:function(e){if(_.bindAll(this),!this.model)throw new Error("no model to bind to!");if(!this.model.fields&&!e)throw new Error("no fields to bind to!");var t=this;this.fields={},_.each(this.model.fields||e,function(e){var i=_.isString(e)?e:e.name,o=t.$("."+i);o.length&&(t.fields[i]=new FieldView({$el:o,field:e,model:t.model}))})},unbindFields:function(){_.each(this.fields,function(e){e.remove()})},bindEvent:function(e,t,i){this.inputEvents=this.inputEvents||[],this.inputEvents.push({input:e,name:t,func:i}),e.on(t,i)},remove:function(){this.unbindFields(),_.each(this.inputEvents,function(e){e.input.off(e.name,e.func)}),this.$el.html(""),this.stopListening()},focus:function(e){var t=this.$(e);setTimeout(function(){t.focus()})}})}()},{}],"/home/zdespolit/projects/_archive/towers/node_modules/views/config.js":[function(e,t,i){t.exports={isProd:window.location.href.indexOf("localhost")<0}},{}],"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/LegendView.js":[function(e,t,i){var o=e("views/base/View"),s=e("models/Templates");t.exports=function(){return o.extend({events:{"click .toggle":function(){this.$(".form-body").toggle()},'change input[type="checkbox"]':function(e){var t=$(e.currentTarget);if(t.data("toggle-all"))this.toggleAll(t.is(":checked"));else if(t.data("toggle-points"))state.set("showPoints",t.is(":checked"));else{var i=t.data("freq-cid"),o=state.get("freqs").get(i);o.switchVisibility()}},"change .color":"onColorChange"},initialize:function(){_.bindAll(this),this.showAll=!1,this.templatePromise=s.get("legend"),this.freqs=state.get("freqs"),this.freqs.each(function(e){e.set({show:!1})}),this.freqs.length||this.$el.hide(),this.listenTo(this.freqs,"add reset remove",this.render),this.listenTo(state,"change:location",this.render),this.listenTo(state,"change:location",this.listenToTowersAddition)},listenToTowersAddition:function(){var e=state.get("location").getTowers();this.listenTo(e,"add",this.render)},render:function(){this.freqs.length&&this.$el.show();var e=this.freqs.filter(_.bind(function(e){return this.has(e)},this));return this.templatePromise.done(_.bind(function(t){var i=t.execute({freqs:e,showAll:this.showAll,showPoints:state.get("showPoints")});this.$el.html(i)},this)),this},has:function(e){for(var t=state.get("location").getTowers(),i=0;i<t.length;i++){var o=t.at(i);if(o.get("freq")==e.get("value"))return!0}return!1},onColorChange:function(e){var t=$(e.currentTarget),i=t.data("freq"),o=this.freqs.findWhere({value:i});o.set("color",t.val()),o.save(),this.freqs.trigger("change",o)},toggleAll:function(e){state.set("showPoints",e),this.showAll=e,this.freqs.each(function(t){t.set({show:e})}),this.$('input[type="checkbox"]').prop("checked",e)}})}()},{"models/Templates":"/home/zdespolit/projects/_archive/towers/node_modules/models/Templates.js","views/base/View":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/View.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/LocationView.js":[function(e,t,i){var o=e("views/base/View"),s=e("models/Templates");t.exports=function(){return o.extend({events:{"click .remove":function(){this.model.revert(),state.set("editModel",null)}},remove:function(){Backbone.trigger("update:location",this.model),o.prototype.remove.apply(this)},initialize:function(e){_.bindAll(this),this.options=e,this.locations=e.locations,this.template=s.get("location")},renderAsync:function(){return this.template.done(_.bind(function(e){var t={name:this.model.getName()},i=e.execute(t);this.$el.html(i),this.delegateEvents(),this.bindFields(),this.focus(".name")},this))}})}()},{"models/Templates":"/home/zdespolit/projects/_archive/towers/node_modules/models/Templates.js","views/base/View":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/View.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/LocationsView.js":[function(e,t,i){var o=e("views/base/ListView"),s=e("models/Location"),n=e("models/Templates");t.exports=function(){return o.extend({initialize:function(e){_.bindAll(this),this.name=e.name,this.templateP=n.get("locations"),this.listenTo(this.collection,"add remove reset change",this.renderAsync)},_afterRender:function(){var e=state.get("location");e!=this.current&&(this.current=e,e&&this.$el.find('li[data-cid="'+e.cid+'"]').addClass("active"),this.$(".show-locations").attr("checked",state.get("showLocations")))},_getType:function(){return"location"},_createModel:function(){return new s},_removeMsg:function(){return"Удалить локацию?"},_canRemove:function(e){var t=!e.getTowers()||0==e.getTowers().length;return t||alert("Чтобы удалить локацию, сперва нужно удалить все вышки."),t}})}()},{"models/Location":"/home/zdespolit/projects/_archive/towers/node_modules/models/Location.js","models/Templates":"/home/zdespolit/projects/_archive/towers/node_modules/models/Templates.js","views/base/ListView":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/ListView.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/PointsView.js":[function(e,t,i){var o=e("views/base/ListView"),s=e("models/Point"),n=e("models/Templates");t.exports=function(){return o.extend({initialize:function(e){_.bindAll(this),this.name=e.name,this.templateP=n.get("list"),this.listenTo(state,"change:tower",function(e,t){this.tower=t,t._isNew()?this.$el.hide():(this.setCollection(e.get("points")),this.$el.show())},this),this.listenTo(state,"change:location",function(){this.$el.hide()},this)},_data:function(){var e=this.tower.get("id"),t=this.collection.filter(function(t){return e==t.get("towerId")}),i=_(t).map(function(e){return{name:e.get("name"),cid:e.cid}});return{name:this.name,list:i.__wrapped__,sort:!1}},_afterRender:function(){this.$(".list-more").removeClass("hidden").html('<div class="wrapper"><label title="Название следущей точки">Название</label><input type="text" class="point-name"/></div>');var e=this.$(".point-name");e.on("change",function(){s.setName($(this).val())})},_editModel:function(e,t){var i=t.parent(),o=$('<input class="edit-point-name" type="text"/>');o.val(e.get("name"));var s=this,n=$('<span class="ok glyphicon glyphicon-ok" title="Готово">').hide().on("click",function(){e.set({name:o.val(),towerId:a.val()}),e.save(),state.trigger("redraw:point",e),s._finishEditing(e,i)}),r=$('<span class="cancel glyphicon glyphicon-remove" title="Отмена">').hide().on("click",function(){s._finishEditing(e,i)}),a=$('<select id="towerSelect" class=""></select>');state.get("location").getTowers().each(function(e){a.append($('<option value="'+e.get("id")+'">'+e.get("name")+"</option>"))}),a.val(e.get("towerId")),i.children().remove();var l=$('<div class="wrapper">');l.append(o),l.append(r),l.append(n),i.append(l),i.append(a)},_finishEditing:function(e,t){e.collection.sort(),t.removeClass("wrapper")},_getType:function(){return"point"},_createModel:function(){var e=state.get("tower");return e?e.id?new s({towerId:e.get("id"),locationId:state.get("location").id}):(alert("Вышка не сохранена. Попробуйте еще раз."),!1):(alert("Не выбрана вышка"),!1)},_removeMsg:function(){return"Удалить точку?"}})}()},{"models/Point":"/home/zdespolit/projects/_archive/towers/node_modules/models/Point.js","models/Templates":"/home/zdespolit/projects/_archive/towers/node_modules/models/Templates.js","views/base/ListView":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/ListView.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/TowerView.js":[function(e,t,i){var o=e("models/Freq"),s=e("views/base/View"),n=e("models/Templates"),r=e("models/Tower");t.exports=function(){return s.extend({events:{"click .bind-color":"bindColor","click .remove":function(){this.model.revert(),state.set("editModel",null)}},initialize:function(e){_.bindAll(this),this.freq=null,this.model=e.model,this.template=n.get("tower"),this.listenTo(this.model,"change:type",this.renderAsync),this.listenTo(this.model,"beforeSave",this.bindColor)},renderAsync:function(){return this.template.done(_.bind(function(e){var t={angles:r.angles[this.model.get("type")],name:this.model.getName()},i=e.execute(t);this.$el.html(i),this.delegateEvents(),this.bindFields(),this.initFreqColor(),this.afterRender(),this.focus(".name")},this))},remove:function(){this.bindColor(),s.prototype.remove.apply(this,arguments)},afterRender:function(){var e=this.$(".type");this.model.isNew()||e.attr("disabled","disabled")},initFreqColor:function(){var e=this;this.listenTo(this.model,"change:color",function(t,i){t.get("freq")&&e.$(".bind-color").show()});var t=this.$(".color");this.listenTo(this.model,"change:freq",function(i,o){if(!o)return void e.$(".bind-color").hide();e.freq&&e.stopListening(e.freq);var s=state.get("freqs").findWhere({value:parseFloat(o)});s?(e.freq=s,e.listenTo(e.freq,"change:color",function(e,i){t.val(i)}),e.model.set("color",s.get("color")),e.$(".color").attr("disabled","disabled"),e.$(".bind-color").hide()):(e.$(".color").removeAttr("disabled","disabled"),e.$(".bind-color").show())})},bindColor:function(){if(!this.$(".bind-color").is(":hidden")){this.freq&&this.stopListening(this.freq);var e=parseFloat(this.model.get("freq"));if(e&&!state.get("freqs").findWhere({value:e})){var t=this.$(".color"),i=new o({value:e,color:t.val()});this.freq=i,this.listenTo(i,"change:color",function(e,i){t.val(i)}),state.get("freqs").add(i),i.save(),this.$(".bind-color").hide(),t.attr("disabled","disabled")}}},getAngle:function(){return this.fields.angle.getValue()},setValue:function(e,t){"angle"!=t&&this[t].setValue.apply(this,arguments)},toString:function(){return"TowerView"}})}()},{"models/Freq":"/home/zdespolit/projects/_archive/towers/node_modules/models/Freq.js","models/Templates":"/home/zdespolit/projects/_archive/towers/node_modules/models/Templates.js","models/Tower":"/home/zdespolit/projects/_archive/towers/node_modules/models/Tower.js","views/base/View":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/View.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/forms/TowersView.js":[function(e,t,i){var o=e("views/base/ListView"),s=e("models/Templates"),n=e("models/Tower");t.exports=function(){return o.extend({initialize:function(e){_.bindAll(this),this.name=e.name,this.templateP=s.get("list"),state.on("change:location",_.bind(function(){var e=state.get("location").getTowers();this.setCollection(e)},this))},_getType:function(){return"tower"},_createModel:function(){return state.get("location")?state.get("location").id?new n({type:"tower",locationId:state.get("location").id}):(alert("Локация еще не сохранена. Попробуйте еще раз"),!1):(alert("Не выбрана локация"),!1)},_removeMsg:function(){return"Удалить вышку?"}})}()},{"models/Templates":"/home/zdespolit/projects/_archive/towers/node_modules/models/Templates.js","models/Tower":"/home/zdespolit/projects/_archive/towers/node_modules/models/Tower.js","views/base/ListView":"/home/zdespolit/projects/_archive/towers/node_modules/views/base/ListView.js"}],"/home/zdespolit/projects/_archive/towers/node_modules/views/map/Geo.js":[function(require,module,exports){module.exports=function(){var geo=function(){return ymaps.coordSystem.geo};return{getAzimuth:function(e,t){return this.azimuthFromDelta(geo().solveInverseProblem(e,t).startDirection)},getDistance:function(e,t){return geo().getDistance(e,t)},endPoint:function(e,t,i){return geo().solveDirectProblem(e,this.deltaFromAzimuth(t),i).endPoint},azimuthFromDelta:function(e){return Math.atan2(e[0],e[1])},deltaFromAzimuth:function(azimuth){with(Math)var delta=[sin(azimuth),cos(azimuth)];return delta}}}()},{}],"/home/zdespolit/projects/_archive/towers/node_modules/views/map/Sector.js":[function(e,t,i){var o=e("views/map/Geo");t.exports=function(){function e(e){if(e>15||0>e)throw new Error("Cant convert to hex: "+e);switch(e){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F";default:return e}}function t(e){function t(e,t){switch(t){case"°":return e*Math.PI/360;case"'":return i(e*Math.PI/360/60);case"":return i(e*Math.PI/360/3600)}throw new Error("Unit not found - "+t)}function o(e,t){return"°"==t?e:null}var s=/(\d+)([^\d]*)/;if(!e||!_.isString(e))throw new Error("Invalid angle");var n={};return e.replace(s,function(e,i,s){n={rad:t(i,s),deg:o(i,s)}}),n}function i(e){return.003>e?.003:e}var s=function(e,i,o,s){function n(e,t,i){return"highway"==e?1:i?1:t/30}this.raw=s&&s.raw,this.center=e,this.sector=this.attrs=i;var r=t(this.sector.angle);this.angle=r.rad,this.angleSteps=n(this.sector.type,r.deg,this.raw),this.gradientSteps="highway"==this.sector.type?1:15,this.map=o,this.geoObjects=o.geoObjects,this.text=this.sector.name+"<br>"+(this.sector.comment?" "+this.sector.comment:""),this.parts=new ymaps.GeoObjectCollection({},{draggable:!1,interactivityModel:"default#transparent"}),this.parts.events.add(["click"],function(e){this.openBalloon()},this),this.base=null};return $.extend(s.prototype,{render:function(){return Math.PI-this.angle<.01?this.renderCircleTower():this.renderSector(),this.raw||this.renderBase(),this},openBalloon:function(){this.base&&this.base.balloon.open()},renderCircleTower:function(){for(var t=this.getLengthSteps(),i=5,o=this.sector.color+e(i)+"0",s=1;s<=this.gradientSteps;s++){var n=t*s,r=new ymaps.Circle([this.center,n],{},{interactivityModel:"default#transparent",fillColor:o,strokeColor:o,strokeWidth:0,opacity:.8});this.parts.add(r)}this.geoObjects.add(this.parts)},renderSector:function(){for(var e,t,i,s,n=null,r=this.sector,a=r.azimuth,l=a-this.angle,c=this.angle/this.angleSteps,d=this.getLengthSteps(),h=null,u=0;u<2*this.angleSteps;u++){n=null,a=l+u*c;for(var m=1;m<=this.gradientSteps;m++)n?(e=n[0],t=n[1],i=o.endPoint(e,a,d),s=o.endPoint(t,a+c,d),h=this.createPolygon([e,i,s,t],m),n=[i,s]):(e=this.center,t=o.endPoint(e,a,d),i=o.endPoint(e,a+c,d),h=this.createPolygon([e,t,i],m),this.first=h,n=[t,i]),this.parts.add(h)}this.geoObjects.add(this.parts)},getLengthSteps:function(){return this.sector.radius/this.gradientSteps},remove:function(){this.parts.removeAll(),this.base&&this.geoObjects.remove(this.base)},createPolygon:function(t,i){if(this.sector.color)s=16-15*i/this.gradientSteps,n=this.sector.color+e(s)+"0";else var o="255,0,0,",s=1.2-i/this.gradientSteps,n="rgb("+o+s+")";var r=new ymaps.Polygon([t,[]],{},{interactivityModel:"default#transparent",fillColor:n,strokeColor:n,strokeWidth:0,opacity:.8});return r},renderBase:function(){var e=new ymaps.Circle([this.center,1],{balloonContentBody:this.text},{fill:!1,strokeWidth:0});this.setBase(e)},setBase:function(e){this.base=e,this.geoObjects.add(e)}}),s}()},{"views/map/Geo":"/home/zdespolit/projects/_archive/towers/node_modules/views/map/Geo.js"}]},{},["/home/zdespolit/projects/_archive/towers/client/views/Router.js"]);
//# sourceMappingURL=app.js.map